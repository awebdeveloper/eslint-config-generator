'use strict';var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var Oncogene=function(){function a(b){_classCallCheck(this,a),b.skipValidation||this.constructor.checkOptions(b),this.handleOptions(b),this.root.classList.add(this.classes.common.root),this.makeStep(0)}return _createClass(a,[{key:'nextStep',value:function nextStep(){this.makeStep(1)}},{key:'prevStep',value:function prevStep(){this.makeStep(-1)}},{key:'makeStep',value:function makeStep(b){return this.stepInx=Math.max(0,this.stepInx+b),this.stepInx>=this.steps.length?this.renderResult():void this.renderStep()}},{key:'renderStep',value:function renderStep(){this.render(this.getStepNode())}},{key:'renderResult',value:function renderResult(){this.render(this.getResultNode())}},{key:'render',value:function render(b){this.clearRoot(),this.root.appendChild(b)}},{key:'createNode',value:function createNode(b){var c=document.createElement('div');return c.className=b,c}},{key:'clearRoot',value:function clearRoot(){for(;this.root.firstChild;)this.root.removeChild(this.root.firstChild)}},{key:'setVal',value:function setVal(b,c){for(var g,d=b.split('.'),f=this.config;1<d.length;){if(g=d.shift(),f.hasOwnProperty(g)||(f[g]={}),!this.constructor.isObject(f[g]))throw new Error('Part of path '+b+' is not an object');f=f[g]}f[d.shift()]=c}},{key:'getStepNode',value:function getStepNode(){var b=this,c=document.createDocumentFragment(),d=this.createNode(this.classes.common.hint),f=this.createNode(this.classes.variants.root),g=this.getProgressNode();return this.getStep().variants.forEach(function(h,j){var k=b.getVariantNode(h,j);f.appendChild(k)}),d.innerHTML=this.getStep().hint||'',c.appendChild(d),c.appendChild(f),c.appendChild(g),c}},{key:'getVariantNode',value:function getVariantNode(b,c){var d=this.createNode(this.classes.variants.item),f=this.createNode(this.classes.variants.hint),g=this.createNode(this.classes.variants.code);return f.innerHTML=b.hint||'',g.innerHTML=b.code||'',d.dataset.inx=c,d.appendChild(f),d.appendChild(g),d.addEventListener('click',this.variantClickHandler.bind(this)),d}},{key:'getProgressNode',value:function getProgressNode(){var b=this.createNode(this.classes.common.progress);return b.innerHTML=this.stepInx+1+' / '+this.steps.length,b}},{key:'getResultNode',value:function getResultNode(){var b=this.createNode(this.classes.result.root),c=this.createNode(this.classes.result.hint),d=this.createNode(this.classes.result.config);return b.appendChild(c),b.appendChild(d),c.innerHTML=this.result.hint,d.textContent=this.getResult(),b}},{key:'variantClickHandler',value:function variantClickHandler(b){var c=this.getStep(),d=b.currentTarget.dataset.inx,f=c.variants[d].value;c.key&&this.setVal(c.key,f),c.callback&&(this.config=c.callback(this.config,f)),this.nextStep()}},{key:'getStep',value:function getStep(){return this.steps[this.stepInx]}},{key:'getResult',value:function getResult(){return JSON.stringify(this.config,null,4)}},{key:'handleOptions',value:function handleOptions(b){if(this.root=document.querySelector(b.selector),this.steps=b.steps,this.config=b.config||{},this.result=Object.assign({hint:''},b.result),this.classes=this.getClasses(),this.stepInx=0,!this.root)throw new Error('Can\'t find element by selector')}},{key:'getClasses',value:function getClasses(){return{common:{root:'oncogene',hint:'oncogene__hint',progress:'oncogene__progress'},variants:{root:'oncogene-variants',hint:'oncogene-variants__hint',item:'oncogene-variants__item',code:'oncogene-variants__code'},result:{root:'oncogene-result',hint:'oncogene-result__hint',config:'oncogene-result__config'}}}}],[{key:'checkOptions',value:function checkOptions(b){var c=this;if(!b)throw new Error('You should specify options');if(['selector','steps'].forEach(function(g){if(!b.hasOwnProperty(g))throw new Error('You should specify '+g)}),['result','classes'].forEach(function(g){if(!c.isUndefined(b[g])&&!c.isObject(b[g]))throw new Error('options.'+g+' should be an object')}),!this.isArray(b.steps))throw new Error('Steps should be an array');b.steps.forEach(function(g,h){var j=h+1;if(c.isUndefined(g.key)&&c.isUndefined(g.callback))throw new Error('Step '+j+' should have key or callback');if(!c.isUndefined(g.callback)&&!c.isFunction(g.callback))throw new Error('Callback of '+j+' step should be a function');if(!c.isArray(g.variants))throw new Error('Step '+j+' should have array of variants');if(2>g.variants.length)throw new Error('Step '+j+' should have at least two variants');g.variants.forEach(function(k,l){var m=l+1;if(c.isUndefined(k.hint)&&c.isUndefined(k.code))throw new Error('Variant '+m+' of step '+j+' should have hint or code');if(c.isUndefined(k.value))throw new Error('Variant '+m+' of step '+j+' should have a value')})})}},{key:'isObject',value:function isObject(b){return b===Object(b)&&!this.isFunction(b)}},{key:'isUndefined',value:function isUndefined(b){return'undefined'==typeof b}},{key:'isFunction',value:function isFunction(b){return'function'==typeof b}},{key:'isString',value:function isString(b){return'string'==typeof b}},{key:'isArray',value:function isArray(b){return Array.isArray(b)}}]),a}();
